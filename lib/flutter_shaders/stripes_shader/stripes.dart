import 'dart:convert';
import 'dart:typed_data';

import 'dart:ui';

import 'package:umbra_flutter/umbra_flutter.dart';

/// {@template stripes}
/// A Dart Shader class for the `stripes` shader.
/// {@endtemplate}
class Stripes extends UmbraShader {
  Stripes._() : super(_cachedProgram!);

  /// {@macro stripes}
  static Future<Stripes> compile() async {
    try {
      // Caching the program on the first compile call.
      _cachedProgram ??= await FragmentProgram.compile(
        spirv: Uint8List.fromList(base64Decode(_spirv)).buffer,
      );

      return Stripes._();
    } on Exception catch (err, stackTrace) {
      throw UmbraException(err, stackTrace);
    }
  }

  static FragmentProgram? _cachedProgram;

  Shader shader({
    required Size resolution,
    required double uTime,
    required double tiles,
    required double speed,
    required double direction,
    required double warpScale,
    required double warpTiling,
  }) {
    return program.shader(
      floatUniforms: Float32List.fromList([
        uTime,
        tiles,
        speed,
        direction,
        warpScale,
        warpTiling,
        resolution.width,
        resolution.height,
      ]),
      samplerUniforms: [],
    );
  }
}

const _spirv =
    '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';
